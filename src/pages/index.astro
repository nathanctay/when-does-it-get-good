---
import BaseLayout from '../layouts/BaseLayout.astro'
import SearchBar from '../components/SearchBar'
import { getTrendingShows } from '../lib/shows'
import { getTMDBImageUrl } from '../lib/tmdb'

const trendingShows = await getTrendingShows(4)
---

<BaseLayout title="Consensus on TV Shows">
	<div class="bg-white border border-slate-300 p-8 md:p-12 mb-8 text-center md:text-left relative overflow-hidden">
		<div class="relative z-10 max-w-3xl">
			<h1 class="text-3xl md:text-5xl font-black text-slate-900 mb-4 tracking-tight">
				TV is a commitment. <br/>
				<span class="text-blue-700">Know when it gets good.</span>
			</h1>
			<p class="text-lg text-slate-600 mb-8 font-medium max-w-xl">
				The community-powered guide to finding the "click" moment in every series. Skip the slog, keep the gold.
			</p>
			
			<div class="md:hidden">
				<SearchBar client:load />
			</div>
			
			<div class="flex flex-wrap gap-4 mt-4 text-sm font-bold text-slate-400 uppercase tracking-widest">
				<span>100% Crowdsourced</span>
				<span>&bull;</span>
				<span>No Accounts Required</span>
				<span>&bull;</span>
				<span>Instant Verdicts</span>
			</div>
		</div>
		<div class="absolute right-0 top-0 bottom-0 w-1/3 bg-gradient-to-l from-blue-50 to-transparent hidden lg:block"></div>
	</div>

	<div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
		<div class="lg:col-span-3">
			<section class="bg-white border border-slate-300">
				<div class="bg-slate-50 border-b border-slate-300 px-6 py-3 flex items-center justify-between">
					<h2 class="text-sm font-black text-slate-700 uppercase tracking-[0.2em] flex items-center gap-2">
						<span class="text-blue-600">‚óè</span> Trending Shows
					</h2>
					<span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Updated Real-time</span>
				</div>
				<div class="p-6">
					<div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-6">
						{trendingShows.map((show) => (
							<a 
								href={`/show/${show.tmdb_id}-${show.title.toLowerCase().replace(/[^a-z0-9]+/g, '-')}`}
								class="group flex flex-col"
							>
								<div class="relative aspect-[2/3] border border-slate-200 mb-3 overflow-hidden shadow-sm group-hover:border-blue-500 transition-colors">
									<img 
										src={getTMDBImageUrl(show.poster_path, 'w342')} 
										alt={show.title}
										class="w-full h-full object-cover"
										loading="lazy"
									/>
								</div>
								<h3 class="font-bold text-slate-900 text-sm group-hover:text-blue-700 transition-colors line-clamp-1">
									{show.title}
								</h3>
								<p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mt-0.5">
									{show.total_seasons} {show.total_seasons === 1 ? 'Season' : 'Seasons'}
								</p>
							</a>
						))}
					</div>
				</div>
			</section>
		</div>

		<aside class="space-y-6">
			<section class="bg-[#2b5876] text-white p-6 border border-[#1e3c50]">
				<h3 class="text-sm font-black uppercase tracking-[0.2em] mb-4 text-blue-200">How it works</h3>
				<ul class="space-y-4 text-sm">
					<li class="flex gap-3">
						<span class="font-black text-blue-300">01</span>
						<span>Search for a show that you're currently watching.</span>
					</li>
					<li class="flex gap-3">
						<span class="font-black text-blue-300">02</span>
						<span>See exactly which episode the fans say it becomes essential.</span>
					</li>
					<li class="flex gap-3">
						<span class="font-black text-blue-300">03</span>
						<span>Cast your own vote to help the community.</span>
					</li>
				</ul>
			</section>

			<section class="bg-white border border-slate-300 p-6">
				<h3 class="text-[10px] font-black uppercase tracking-[0.2em] mb-4 text-slate-400">About WDIGG</h3>
				<p class="text-xs leading-relaxed text-slate-600 font-medium">
					"When Does It Get Good?" is an open community tool for the golden age of television. We aggregate fan data to solve the "Three Episode Rule" once and for all.
				</p>
				<a href="/about" class="inline-block mt-4 text-[10px] font-black text-blue-600 uppercase tracking-widest hover:underline">Read More &rarr;</a>
			</section>
		</aside>
	</div>
</BaseLayout>
